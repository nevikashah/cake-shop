<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üç¶ Neobrutalism Ice Cream Shop</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    :root {
      --background: 225 20% 95%;
      --foreground: 225 20% 10%;
      --card: 225 20% 100%;
      --card-foreground: 225 20% 10%;
      --popover: 225 20% 100%;
      --popover-foreground: 225 20% 10%;
      --primary: 225 20% 10%;
      --primary-foreground: 225 20% 95%;
      --secondary: 225 20% 90%;
      --secondary-foreground: 225 20% 10%;
      --secondary-background: 225 20% 85%;
      --muted: 225 10% 80%;
      --muted-foreground: 225 10% 45%;
      --accent: 225 20% 85%;
      --accent-foreground: 225 20% 10%;
      --destructive: 0 84% 60%;
      --destructive-foreground: 0 0% 98%;
      --border: 225 20% 20%;
      --input: 225 20% 90%;
      --ring: 225 20% 20%;
      --main: 47 100% 50%;
      --main-foreground: 225 20% 10%;
    }

    @import url('https://fonts.googleapis.com/css2?family=Geist+Sans:wght@400;500;600;700&family=Geist+Mono:wght@400;500;600&display=swap');
    
    :root {
      --font-heading: 'Geist Sans', sans-serif;
      --font-base: 'Geist Sans', sans-serif;
    }

    body {
      font-family: var(--font-base);
    }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            border: 'hsl(var(--border))',
            input: 'hsl(var(--input))',
            ring: 'hsl(var(--ring))',
            background: 'hsl(var(--background))',
            foreground: 'hsl(var(--foreground))',
            primary: {
              DEFAULT: 'hsl(var(--primary))',
              foreground: 'hsl(var(--primary-foreground))',
            },
            secondary: {
              DEFAULT: 'hsl(var(--secondary))',
              foreground: 'hsl(var(--secondary-foreground))',
              background: 'hsl(var(--secondary-background))',
            },
            destructive: {
              DEFAULT: 'hsl(var(--destructive))',
              foreground: 'hsl(var(--destructive-foreground))',
            },
            muted: {
              DEFAULT: 'hsl(var(--muted))',
              foreground: 'hsl(var(--muted-foreground))',
            },
            accent: {
              DEFAULT: 'hsl(var(--accent))',
              foreground: 'hsl(var(--accent-foreground))',
            },
            popover: {
              DEFAULT: 'hsl(var(--popover))',
              foreground: 'hsl(var(--popover-foreground))',
            },
            card: {
              DEFAULT: 'hsl(var(--card))',
              foreground: 'hsl(var(--card-foreground))',
            },
            main: {
              DEFAULT: 'hsl(var(--main))',
              foreground: 'hsl(var(--main-foreground))',
            },
          },
          borderRadius: {
            base: '8px',
          },
          fontFamily: {
            heading: ['var(--font-heading)'],
            base: ['var(--font-base)'],
          },
          boxShadow: {
            base: '4px 4px 0px 0px hsl(var(--border))',
            'base-md': '6px 6px 0px 0px hsl(var(--border))',
            'base-lg': '8px 8px 0px 0px hsl(var(--border))',
          },
        },
      },
    }
  </script>
</head>
<body class="bg-background text-foreground min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // UI Components
    const Button = ({ children, variant = 'default', size = 'default', className = '', onClick, disabled, ...props }) => {
      const variants = {
        default: 'bg-main text-main-foreground shadow-base hover:bg-main/90',
        neutral: 'bg-secondary-background text-foreground shadow-base hover:bg-secondary-background/90',
        secondary: 'bg-secondary text-secondary-foreground shadow-base hover:bg-secondary/80',
        ghost: 'hover:bg-accent hover:text-accent-foreground shadow-none border-none',
        link: 'text-primary underline-offset-4 hover:underline shadow-none border-none',
        noShadow: 'bg-main text-main-foreground hover:bg-main/90 shadow-none',
      };
      
      const sizes = {
        default: 'h-10 px-4 py-2',
        sm: 'h-9 px-3 text-sm',
        lg: 'h-11 px-8',
        icon: 'h-10 w-10',
      };

      const classes = `
        inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-base text-sm font-bold
        ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 
        focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none 
        disabled:opacity-50 border-2 border-border active:translate-x-[3px] active:translate-y-[3px] 
        active:shadow-none transition-all cursor-pointer
        ${variants[variant]} ${sizes[size]} ${className}
      `.trim().replace(/\s+/g, ' ');

      return React.createElement('button', {
        className: classes,
        onClick,
        disabled,
        ...props
      }, children);
    };

    const Card = ({ children, className = '', ...props }) => {
      return React.createElement('div', {
        className: `rounded-base border-2 border-border bg-card text-card-foreground shadow-base ${className}`,
        ...props
      }, children);
    };

    const CardHeader = ({ children, className = '', ...props }) => {
      return React.createElement('div', {
        className: `flex flex-col space-y-1.5 p-6 ${className}`,
        ...props
      }, children);
    };

    const CardTitle = ({ children, className = '', ...props }) => {
      return React.createElement('h3', {
        className: `text-2xl font-bold leading-none tracking-tight ${className}`,
        ...props
      }, children);
    };

    const CardDescription = ({ children, className = '', ...props }) => {
      return React.createElement('p', {
        className: `text-sm text-muted-foreground ${className}`,
        ...props
      }, children);
    };

    const CardContent = ({ children, className = '', ...props }) => {
      return React.createElement('div', {
        className: `p-6 pt-0 ${className}`,
        ...props
      }, children);
    };

    const CardFooter = ({ children, className = '', ...props }) => {
      return React.createElement('div', {
        className: `flex items-center p-6 pt-0 ${className}`,
        ...props
      }, children);
    };

    const Input = ({ className = '', onChange, ...props }) => {
      return React.createElement('input', {
        className: `flex h-10 w-full rounded-base border-2 border-border bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${className}`,
        onChange: onChange ? (e) => onChange(e.target.value) : undefined,
        ...props
      });
    };

    const Label = ({ children, className = '', ...props }) => {
      return React.createElement('label', {
        className: `text-sm font-bold leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${className}`,
        ...props
      }, children);
    };

    // Constants
    const FLAVORS = [
      'Vanilla', 'Chocolate', 'Strawberry', 'Mint Chocolate Chip', 
      'Cookies & Cream', 'Rocky Road', 'Pistachio', 'Neapolitan'
    ];

    const TOPPINGS = [
      'Sprinkles', 'Hot Fudge', 'Caramel', 'Whipped Cream', 
      'Cherry', 'Nuts', 'Chocolate Chips', 'Gummy Bears'
    ];

    // Main App Component
    function IceCreamApp() {
      const [activeTab, setActiveTab] = useState('order');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      
      // Order form state
      const [customerName, setCustomerName] = useState('');
      const [selectedFlavor, setSelectedFlavor] = useState('');
      const [selectedSize, setSelectedSize] = useState('medium');
      const [selectedToppings, setSelectedToppings] = useState([]);
      const [lastOrder, setLastOrder] = useState(null);
      
      // Status check state
      const [statusOrderId, setStatusOrderId] = useState('');
      const [orderStatus, setOrderStatus] = useState(null);
      
      // Stats state
      const [stats, setStats] = useState(null);

      const handleToppingToggle = (topping) => {
        setSelectedToppings(prev => 
          prev.includes(topping) 
            ? prev.filter(t => t !== topping)
            : [...prev, topping]
        );
      };

      const handlePlaceOrder = async () => {
        if (!customerName || !selectedFlavor) {
          setError('Please fill in your name and select a flavor!');
          return;
        }

        setLoading(true);
        setError(null);
        try {
          const response = await fetch('/order', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              customerName,
              flavor: selectedFlavor,
              size: selectedSize,
              toppings: selectedToppings
            })
          });

          const data = await response.json();
          
          if (data.success) {
            setLastOrder(data);
            // Clear form
            setCustomerName('');
            setSelectedFlavor('');
            setSelectedToppings([]);
            setSelectedSize('medium');
          } else {
            setError('Failed to place order: ' + data.message);
          }
        } catch (error) {
          setError('Error placing order: ' + String(error));
        } finally {
          setLoading(false);
        }
      };

      const handleCheckStatus = async () => {
        if (!statusOrderId) {
          setError('Please enter an order ID!');
          return;
        }

        setLoading(true);
        setError(null);
        try {
          const response = await fetch(`/status/${statusOrderId}`);
          if (response.ok) {
            const data = await response.json();
            setOrderStatus(data);
          } else {
            const errorData = await response.json();
            setError('Error: ' + errorData.error);
          }
        } catch (error) {
          setError('Error checking status: ' + String(error));
        } finally {
          setLoading(false);
        }
      };

      const handleLoadStats = async () => {
        setLoading(true);
        setError(null);
        try {
          const response = await fetch('/orders/stats');
          const data = await response.json();
          setStats(data);
        } catch (error) {
          setError('Error loading stats: ' + String(error));
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        if (activeTab === 'stats') {
          handleLoadStats();
        }
      }, [activeTab]);

      return React.createElement('div', {
        className: 'min-h-screen bg-background p-4'
      }, [
        React.createElement('div', {
          key: 'container',
          className: 'mx-auto max-w-4xl space-y-6'
        }, [
          // Header
          React.createElement(Card, {
            key: 'header',
            className: 'bg-main text-main-foreground'
          }, [
            React.createElement(CardHeader, {
              key: 'header-content',
              className: 'text-center'
            }, [
              React.createElement(CardTitle, {
                key: 'title',
                className: 'text-4xl'
              }, 'üç¶ Neobrutalism Ice Cream Shop'),
              React.createElement(CardDescription, {
                key: 'desc',
                className: 'text-main-foreground/80 text-lg'
              }, 'Demo powered by Cloudflare Workers + Hono + Queues')
            ])
          ]),

          // Error Display
          error && React.createElement(Card, {
            key: 'error',
            className: 'bg-destructive text-destructive-foreground'
          }, [
            React.createElement(CardContent, {
              key: 'error-content',
              className: 'pt-6'
            }, [
              React.createElement('div', {
                key: 'error-text',
                className: 'flex items-center gap-2'
              }, [
                React.createElement('span', { key: 'icon' }, '‚ö†Ô∏è'),
                React.createElement('span', { key: 'text' }, error),
                React.createElement(Button, {
                  key: 'close',
                  onClick: () => setError(null),
                  variant: 'ghost',
                  size: 'sm',
                  className: 'ml-auto text-destructive-foreground hover:bg-destructive-foreground/20'
                }, '‚úï')
              ])
            ])
          ]),

          // Navigation
          React.createElement('div', {
            key: 'nav',
            className: 'flex gap-2 justify-center'
          }, ['order', 'status', 'stats'].map(tab => 
            React.createElement(Button, {
              key: tab,
              variant: activeTab === tab ? 'default' : 'neutral',
              onClick: () => setActiveTab(tab),
              className: 'capitalize'
            }, `${tab === 'order' ? 'üìù' : tab === 'status' ? 'üìä' : 'üìà'} ${tab}`)
          )),

          // Order Tab
          activeTab === 'order' && React.createElement('div', {
            key: 'order-tab',
            className: 'grid gap-6 md:grid-cols-2'
          }, [
            React.createElement(Card, { key: 'order-form' }, [
              React.createElement(CardHeader, { key: 'form-header' }, [
                React.createElement(CardTitle, { key: 'form-title' }, 'Place Your Order üç®'),
                React.createElement(CardDescription, { key: 'form-desc' }, 'Choose your favorite ice cream combination')
              ]),
              React.createElement(CardContent, {
                key: 'form-content',
                className: 'space-y-4'
              }, [
                // Customer Name
                React.createElement('div', {
                  key: 'name-section',
                  className: 'space-y-2'
                }, [
                  React.createElement(Label, { key: 'name-label' }, 'Your Name'),
                  React.createElement(Input, {
                    key: 'name-input',
                    placeholder: 'Enter your name',
                    value: customerName,
                    onChange: setCustomerName
                  })
                ]),

                // Flavors
                React.createElement('div', {
                  key: 'flavor-section',
                  className: 'space-y-2'
                }, [
                  React.createElement(Label, { key: 'flavor-label' }, 'Choose Flavor'),
                  React.createElement('div', {
                    key: 'flavor-grid',
                    className: 'grid grid-cols-2 gap-2'
                  }, FLAVORS.map(flavor =>
                    React.createElement(Button, {
                      key: flavor,
                      variant: selectedFlavor === flavor ? 'default' : 'neutral',
                      size: 'sm',
                      onClick: () => setSelectedFlavor(flavor),
                      className: 'text-xs justify-start'
                    }, flavor)
                  ))
                ]),

                // Size
                React.createElement('div', {
                  key: 'size-section',
                  className: 'space-y-2'
                }, [
                  React.createElement(Label, { key: 'size-label' }, 'Size'),
                  React.createElement('div', {
                    key: 'size-buttons',
                    className: 'flex gap-2'
                  }, ['small', 'medium', 'large'].map(size =>
                    React.createElement(Button, {
                      key: size,
                      variant: selectedSize === size ? 'default' : 'neutral',
                      size: 'sm',
                      onClick: () => setSelectedSize(size),
                      className: 'capitalize flex-1'
                    }, size)
                  ))
                ]),

                // Toppings
                React.createElement('div', {
                  key: 'toppings-section',
                  className: 'space-y-2'
                }, [
                  React.createElement(Label, { key: 'toppings-label' }, 'Toppings (Optional)'),
                  React.createElement('div', {
                    key: 'toppings-grid',
                    className: 'grid grid-cols-2 gap-2'
                  }, TOPPINGS.map(topping =>
                    React.createElement(Button, {
                      key: topping,
                      variant: selectedToppings.includes(topping) ? 'default' : 'neutral',
                      size: 'sm',
                      onClick: () => handleToppingToggle(topping),
                      className: 'text-xs justify-start'
                    }, `${selectedToppings.includes(topping) ? '‚úì ' : ''}${topping}`)
                  ))
                ])
              ]),
              React.createElement(CardFooter, { key: 'form-footer' }, [
                React.createElement(Button, {
                  key: 'submit-button',
                  onClick: handlePlaceOrder,
                  disabled: loading || !customerName || !selectedFlavor,
                  className: 'w-full',
                  size: 'lg'
                }, loading ? 'Placing Order...' : 'üç¶ Place Order')
              ])
            ]),

            // Order Success
            lastOrder && React.createElement(Card, {
              key: 'order-success',
              className: 'bg-secondary text-secondary-foreground'
            }, [
              React.createElement(CardHeader, { key: 'success-header' }, [
                React.createElement(CardTitle, { key: 'success-title' }, 'Order Placed Successfully! üéâ'),
                React.createElement(CardDescription, {
                  key: 'success-desc',
                  className: 'text-secondary-foreground/80'
                }, lastOrder.message)
              ]),
              React.createElement(CardContent, {
                key: 'success-content',
                className: 'space-y-2'
              }, [
                React.createElement('div', { key: 'order-id' }, [
                  React.createElement('strong', null, 'Order ID: '),
                  React.createElement('code', {
                    className: 'bg-background text-foreground px-2 py-1 rounded text-sm'
                  }, lastOrder.orderId)
                ]),
                React.createElement('div', { key: 'customer' }, [
                  React.createElement('strong', null, 'Customer: '),
                  lastOrder.order.customer
                ]),
                React.createElement('div', { key: 'item' }, [
                  React.createElement('strong', null, 'Item: '),
                  lastOrder.order.item
                ]),
                lastOrder.order.toppings.length > 0 && React.createElement('div', { key: 'toppings' }, [
                  React.createElement('strong', null, 'Toppings: '),
                  lastOrder.order.toppings.join(', ')
                ]),
                React.createElement('div', { key: 'time' }, [
                  React.createElement('strong', null, 'Estimated Time: '),
                  lastOrder.estimatedTime
                ])
              ]),
              React.createElement(CardFooter, { key: 'success-footer' }, [
                React.createElement(Button, {
                  key: 'check-status',
                  variant: 'neutral',
                  onClick: () => {
                    setStatusOrderId(lastOrder.orderId);
                    setActiveTab('status');
                  },
                  className: 'w-full'
                }, 'üìä Check Status')
              ])
            ])
          ]),

          // Status Tab
          activeTab === 'status' && React.createElement(Card, { key: 'status-tab' }, [
            React.createElement(CardHeader, { key: 'status-header' }, [
              React.createElement(CardTitle, { key: 'status-title' }, 'Check Order Status üìä'),
              React.createElement(CardDescription, { key: 'status-desc' }, 'Enter your order ID to see the current status')
            ]),
            React.createElement(CardContent, {
              key: 'status-content',
              className: 'space-y-4'
            }, [
              React.createElement('div', {
                key: 'status-input',
                className: 'flex gap-2'
              }, [
                React.createElement(Input, {
                  key: 'id-input',
                  placeholder: 'Enter your order ID',
                  value: statusOrderId,
                  onChange: setStatusOrderId,
                  className: 'flex-1'
                }),
                React.createElement(Button, {
                  key: 'check-button',
                  onClick: handleCheckStatus,
                  disabled: loading || !statusOrderId
                }, loading ? 'Checking...' : 'Check Status')
              ]),

              orderStatus && React.createElement(Card, {
                key: 'status-result',
                className: 'bg-secondary text-secondary-foreground'
              }, [
                React.createElement(CardContent, {
                  key: 'status-details',
                  className: 'pt-6'
                }, [
                  React.createElement('div', {
                    key: 'status-info',
                    className: 'space-y-2'
                  }, [
                    React.createElement('div', { key: 'id' }, [
                      React.createElement('strong', null, 'Order ID: '),
                      orderStatus.orderId
                    ]),
                    React.createElement('div', { key: 'status' }, [
                      React.createElement('strong', null, 'Status: '),
                      React.createElement('span', { className: 'capitalize font-bold' }, orderStatus.status)
                    ]),
                    React.createElement('div', { key: 'message' }, [
                      React.createElement('strong', null, 'Message: '),
                      orderStatus.message
                    ]),
                    orderStatus.estimatedWaitTime && React.createElement('div', { key: 'wait' }, [
                      React.createElement('strong', null, 'Estimated Wait: '),
                      orderStatus.estimatedWaitTime
                    ])
                  ])
                ])
              ])
            ])
          ]),

          // Stats Tab
          activeTab === 'stats' && React.createElement('div', {
            key: 'stats-tab',
            className: 'space-y-6'
          }, [
            React.createElement(Card, { key: 'stats-header' }, [
              React.createElement(CardHeader, { key: 'stats-header-content' }, [
                React.createElement(CardTitle, { key: 'stats-title' }, 'üìà Shop Statistics'),
                React.createElement(CardDescription, { key: 'stats-desc' }, 'Real-time insights into our ice cream shop')
              ])
            ]),

            stats && React.createElement('div', {
              key: 'stats-content',
              className: 'grid gap-6 md:grid-cols-2'
            }, [
              React.createElement(Card, { key: 'flavors-card' }, [
                React.createElement(CardHeader, { key: 'flavors-header' }, [
                  React.createElement(CardTitle, { key: 'flavors-title' }, 'üèÜ Popular Flavors')
                ]),
                React.createElement(CardContent, { key: 'flavors-content' }, [
                  React.createElement('div', {
                    key: 'flavors-list',
                    className: 'space-y-2'
                  }, stats.stats.popularFlavors.map(flavor =>
                    React.createElement('div', {
                      key: flavor.flavor,
                      className: 'flex justify-between items-center'
                    }, [
                      React.createElement('span', { key: 'name' }, flavor.flavor),
                      React.createElement('div', {
                        key: 'progress',
                        className: 'flex items-center gap-2'
                      }, [
                        React.createElement('div', {
                          key: 'bar-bg',
                          className: 'w-20 h-2 bg-secondary rounded'
                        }, [
                          React.createElement('div', {
                            key: 'bar-fill',
                            className: 'h-full bg-main rounded',
                            style: { width: `${flavor.percentage}%` }
                          })
                        ]),
                        React.createElement('span', {
                          key: 'percentage',
                          className: 'text-sm font-bold'
                        }, `${flavor.percentage}%`)
                      ])
                    ])
                  ))
                ])
              ]),

              React.createElement(Card, { key: 'quick-stats' }, [
                React.createElement(CardHeader, { key: 'quick-header' }, [
                  React.createElement(CardTitle, { key: 'quick-title' }, 'üìä Quick Stats')
                ]),
                React.createElement(CardContent, {
                  key: 'quick-content',
                  className: 'space-y-4'
                }, [
                  React.createElement('div', {
                    key: 'daily',
                    className: 'flex justify-between'
                  }, [
                    React.createElement('span', { key: 'daily-label' }, 'Daily Orders:'),
                    React.createElement('span', {
                      key: 'daily-value',
                      className: 'font-bold'
                    }, stats.stats.dailyOrders)
                  ]),
                  React.createElement('div', {
                    key: 'processing',
                    className: 'flex justify-between'
                  }, [
                    React.createElement('span', { key: 'proc-label' }, 'Avg Processing:'),
                    React.createElement('span', {
                      key: 'proc-value',
                      className: 'font-bold'
                    }, stats.stats.averageProcessingTime)
                  ]),
                  React.createElement('div', {
                    key: 'size',
                    className: 'flex justify-between'
                  }, [
                    React.createElement('span', { key: 'size-label' }, 'Popular Size:'),
                    React.createElement('span', {
                      key: 'size-value',
                      className: 'font-bold capitalize'
                    }, stats.stats.popularSize)
                  ]),
                  React.createElement('div', { key: 'toppings-section' }, [
                    React.createElement('div', {
                      key: 'toppings-label',
                      className: 'font-bold mb-2'
                    }, 'Top Toppings:'),
                    React.createElement('div', {
                      key: 'toppings-list',
                      className: 'flex flex-wrap gap-1'
                    }, stats.stats.topToppings.map(topping =>
                      React.createElement('span', {
                        key: topping,
                        className: 'px-2 py-1 bg-main text-main-foreground rounded text-xs'
                      }, topping)
                    ))
                  ])
                ])
              ])
            ]),

            React.createElement(Button, {
              key: 'refresh-stats',
              onClick: handleLoadStats,
              disabled: loading,
              variant: 'neutral',
              className: 'w-full'
            }, loading ? 'Loading...' : 'üîÑ Refresh Stats')
          ])
        ])
      ]);
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(IceCreamApp));
  </script>
</body>
</html>
